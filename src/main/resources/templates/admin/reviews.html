<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Review</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div th:replace="~{admin/fragments/sidebar :: sidebar(activePage='reviews')}"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between p-4">
                    <h1 class="text-2xl font-semibold text-gray-800">Manage Reviews</h1>
                </div>
            </header>

            <!-- Page Content -->
            <main class="flex-1 overflow-y-auto p-6">
                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-white rounded-lg shadow p-4">
                        <p class="text-gray-500 text-sm">Total Reviews</p>
                        <p class="text-2xl font-bold text-gray-800" th:text="${totalReviews}">0</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <p class="text-gray-500 text-sm">Average Rating</p>
                        <div class="flex items-center">
                            <p class="text-2xl font-bold text-yellow-500 mr-2" th:text="${averageRating}">0</p>
                            <div class="flex text-yellow-500">
                                <i class="fas fa-star text-sm"></i>
                                <i class="fas fa-star text-sm"></i>
                                <i class="fas fa-star text-sm"></i>
                                <i class="fas fa-star text-sm"></i>
                                <i class="fas fa-star-half-alt text-sm"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-4">
                        <p class="text-gray-500 text-sm">Pending Approval</p>
                        <p class="text-2xl font-bold text-orange-600" th:text="${pendingReviews}">0</p>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-white rounded-lg shadow p-4 mb-6">
                    <form class="flex items-center gap-4" method="get" th:action="@{/admin/reviews}">
                        <div class="flex-1"></div>
                        <select name="status" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="" th:selected="${selectedStatus == ''}">All Status</option>
                            <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}" th:selected="${selectedStatus == s}"></option>
                        </select>
                        <input type="hidden" name="page" value="0" />
                        <input type="hidden" name="size" th:value="${reviews.size}" />
                        <button type="submit" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded-lg">
                            <i class="fas fa-filter"></i>
                        </button>
                    </form>
                </div>

                <!-- Reviews List -->
                <div class="space-y-4">
                    <div th:if="${!hasReviews}" class="bg-white rounded-lg shadow p-6 text-gray-700">
                        No reviews found.
                    </div>

                    <div th:each="review : ${reviews.content}" class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-user text-gray-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800" th:text="${review.userName != null && review.userName.trim() != '' ? review.userName : (review.userEmail != null ? review.userEmail : 'Unknown')}">User</p>
                                    <p class="text-sm text-gray-500" th:text="${review.tourName}">Tour</p>
                                </div>
                            </div>
                            <div class="flex items-center text-yellow-500">
                                <span class="ml-2 text-gray-600 text-sm" th:text="${review.rating}">0</span>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-3" th:text="${review.content}">content</p>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-gray-500" th:text="${review.createdAt}">date</span>
                            <div class="space-x-2">
                                <form th:if="${review.status == 'PENDING'}" class="inline" method="post" th:action="@{'/admin/reviews/' + ${review.id} + '/approve'}">
                                    <input type="hidden" name="status" th:value="${selectedStatus}" />
                                    <input type="hidden" name="page" th:value="${reviews.number}" />
                                    <input type="hidden" name="size" th:value="${reviews.size}" />
                                    <button type="submit" class="px-3 py-1 bg-green-100 text-green-800 rounded hover:bg-green-200">
                                        <i class="fas fa-check mr-1"></i> Approve
                                    </button>
                                </form>
                                <form th:if="${review.status == 'PENDING'}" class="inline" method="post" th:action="@{'/admin/reviews/' + ${review.id} + '/reject'}">
                                    <input type="hidden" name="status" th:value="${selectedStatus}" />
                                    <input type="hidden" name="page" th:value="${reviews.number}" />
                                    <input type="hidden" name="size" th:value="${reviews.size}" />
                                    <button type="submit" class="px-3 py-1 bg-red-100 text-red-800 rounded hover:bg-red-200">
                                        <i class="fas fa-times mr-1"></i> Reject
                                    </button>
                                </form>

                                <span th:if="${review.status != 'PENDING'}" class="px-3 py-1 bg-gray-100 text-gray-800 rounded" th:text="${review.status}">STATUS</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="mt-6 flex justify-center">
                    <div class="flex items-center space-x-2">
                        <a th:if="${reviews.hasPrevious()}"
                           th:href="@{/admin/reviews(status=${selectedStatus},page=${reviews.number - 1},size=${reviews.size})}"
                           class="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Trước</a>
                        <span th:if="${!reviews.hasPrevious()}"
                              class="px-3 py-2 border border-gray-200 rounded-md text-sm font-medium text-gray-400 bg-gray-50">Trước</span>

                        <span class="px-3 py-2 border border-blue-600 bg-blue-600 text-white rounded-md text-sm font-medium"
                              th:text="${reviews.number + 1}">1</span>

                        <a th:if="${reviews.hasNext()}"
                           th:href="@{/admin/reviews(status=${selectedStatus},page=${reviews.number + 1},size=${reviews.size})}"
                           class="px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Sau</a>
                        <span th:if="${!reviews.hasNext()}"
                              class="px-3 py-2 border border-gray-200 rounded-md text-sm font-medium text-gray-400 bg-gray-50">Sau</span>
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>
</html>
